# 0. MVP 목표(수정)

## MVP 목표(수정본)

- 사용자가 **게임 시작 → Level 등장(인트로/정보) → 퍼즐 플레이 → 완성 → 보상 수령 → 갤러리 저장** 흐름을 반복.
- **Level 데이터에 따라**:
    - 사용되는 **이미지(imageId)** 가 다르고,
    - **조각 개수(pieceCount 또는 grid)** 가 다르게 설정될 수 있어야 함.
    - 사용하는 조각 개수는 Level 별로 coloum 및 row를 설정하여 변경할 수 있어야함.
- 퍼즐 진행 중 **자동 저장/복귀**, 최소한의 **힌트(리워드 광고 포함)** 제공.

## MVP 범위(수정 영향)

- 기존의 “Theme/Image Select + Difficulty Select”는 MVP에서 **제거하거나 후순위로 전환** 가능
- 대신 **LevelConfig(레벨 테이블)** 를 기반으로 콘텐츠가 자동 결정

---

# 1. 화면 플로우(수정)

## 기본안(권장): 선형 진행(레벨 선택 화면 없음)

1. Boot
2. Home(현재 Level 표시 + Start)
3. **Level Intro(신규)**: “Level N”, 이미지 프리뷰, 조각 수/목표 표시
4. Loading
5. Puzzle Play
6. Result(“Level N Complete”)
7. Gallery(완성작 저장/확인)
8. Home(다음 Level로)

## 대안(옵션): Level Select(맵/리스트)

- Home → Level Select → Level Intro → Play …
- MVP에서는 선형 진행이 구현/UX가 가장 단순하고 안정적입니다.

---

# 2. 화면별 UI 구성(추가/변경분만)

## 2.1 Home(변경)

- `CurrentLevelWidget`
    - “LEVEL 12” 텍스트
    - 진행률(예: 완료 레벨/전체) 옵션
- `StartButton`(= 현재 레벨 시작)
- `ContinueCard`(진행 중 세션 있으면 이어하기)

## 2.2 Level Intro(신규)

- 상단: 뒤로가기(선형 진행이면 “Home로”) / 코인
- 중앙:
    - `LevelTitle`: “LEVEL N”
    - `PreviewImage`: 해당 레벨 이미지 썸네일(정사각/가로형 크롭)
    - `LevelInfo`:
        - 조각 수(예: “48 Pieces”)
        - 힌트 보너스(옵션)
- 하단:
    - `PlayButton`
    - (옵션) “난이도 변경”은 MVP에서는 비활성(레벨이 난이도를 결정)

## 2.3 Result(변경)

- “LEVEL N COMPLETE”
- 보상: 레벨 보상 + 리워드 광고로 2배
- “Next Level” 버튼(선형 진행 핵심)

## 2.4 Gallery(변경)

- 저장 단위 선택:
    - (권장) **레벨 완료 기록 기반**으로 갤러리 카드 생성
    - 카드: `levelNumber`, `imageThumbnail`, 완료 배지

---

# 3. 레벨 기반 시스템 규칙(핵심 요구사항 반영)

## 3.1 Level이 결정하는 것(필수)

각 Level은 아래를 최소 포함:

- `levelNumber` (int)
- `imageId` (string)
- `pieceCount` 또는 `grid` (예: cols/rows)
- `seed` (선택: 고정 퍼즐 재현용)
- `rewardCoin` (선택: 레벨별 보상 튜닝)

### 설정 방식

- (권장) `LevelDatabaseSO`(ScriptableObject) 또는 JSON 테이블
- 운영 편의상 **레벨 테이블이 단일 진실 소스**가 되도록 설계

## 3.2 조각 수 표현 방식(권장안)

- **grid 기반**: `cols`, `rows`로 결정(디바이스 비율 대응 쉬움)
    - 예: 24=6x4, 48=8x6, 96=12x8
- 또는 `pieceCount`만 두고 내부에서 최적 grid를 계산(초기엔 구현 복잡도 ↑)
- MVP에서는 **grid 명시가 안정적**입니다.

## 3.3 보상 규칙(레벨 기반)

- `rewardCoin`을 레벨 테이블에서 직접 지정하거나,
- 기본식(예):
    - `reward = base + pieceCountWeight`
    - 예: 24→50, 48→80, 96→130 (기존값 유지 가능)
- Result에서 리워드 광고 시 2배(추가 지급 방식)

---

# 4. 데이터 모델/세이브 구조(수정)

## 4.1 PlayerProfile(추가 필드)

- `currentLevel` (int) : 다음에 플레이할 레벨
- `maxUnlockedLevel` (int) : 선택형 레벨 셀렉트 도입 시 필요(선형이면 currentLevel만으로도 충분)
- `completedLevels` (HashSet<int> 또는 bitset)
- (기존) `coin`, `settings`, `dailyHintState`

## 4.2 ActivePuzzleSession(변경 필수)

- `levelNumber` (int) **추가(필수)**
- `imageId` (string) (레벨 테이블과 일치 검증용)
- `gridCols`, `gridRows` 또는 `pieceCount`
- `seed`
- 진행 상태(placedPieceIds / transforms 등 기존 유지)

## 4.3 완료 처리

- 레벨 완료 시:
    1. `completedLevels`에 추가
    2. `currentLevel = currentLevel + 1`
    3. `ActivePuzzleSession` 삭제
    4. Gallery 엔트리 생성(또는 completedLevels로부터 파생 표시)

---

# 5. 개발 체크리스트(레벨 시스템 추가분)

## 5.1 레벨 테이블

- [ ]  `LevelConfig` 정의(최소: levelNumber, imageId, grid/reward/seed)
- [ ]  `LevelDatabase` 로더 구현(SO or JSON)
- [ ]  유효성 검사:
    - [ ]  imageId 존재 여부
    - [ ]  grid 값 정상(0/음수 방지)
    - [ ]  레벨 중복 방지

## 5.2 게임 상태/플로우

- [ ]  Home에서 `currentLevel`을 읽어 Start/Continue 분기
- [ ]  Level Intro에서 LevelConfig 표시 후 Play 진입
- [ ]  Result에서 Next Level 처리(세이브 포함)

## 5.3 세이브/복귀

- [ ]  ActiveSession에 levelNumber 포함
- [ ]  앱 재실행 시:
    - ActiveSession 있으면 Continue
    - 없으면 currentLevel 기준으로 Start

---

# 6. 권장 기본 구조(코딩 A.I.에게 전달하는 결론)

- MVP는 **선형 Level 진행**으로 간소화
- 콘텐츠/난이도(조각 수)는 **LevelConfig 테이블**이 단일 제어점
- 세이브는 **ActivePuzzleSession에 levelNumber + grid + seed** 포함이 필수