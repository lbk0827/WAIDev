# 0. MVP 목표와 범위

## MVP 목표

- 사용자가 **이미지 선택 → 조각 수 선택 → 퍼즐 플레이 → 완성 → 보상 수령 → 갤러리 저장**을 문제없이 반복.
- 퍼즐 진행 중 **자동 저장/복귀**, 최소한의 **힌트(리워드 광고 포함)** 제공.
- 성능/터치 UX가 “캐주얼 수준”으로 안정적.

## MVP 범위(포함)

- 3단계 난이도(예: 24/48/96 조각)
- 테마/이미지 선택(기본 12장 내외 권장)
- 퍼즐 플레이(드래그, 스냅, 그룹 이동(선택), 트레이)
- 힌트 3종 + 리워드 광고로 획득
- 결과 화면 + 코인 보상 + 갤러리 저장
- 진행 중 퍼즐 1개 “이어하기”
- 설정(사운드/진동/광고 제거는 MVP에서는 토글만, IAP는 제외 가능)

## MVP 제외(후순위)

- 회전 퍼즐, 멀티 퍼즐 동시 진행
- 주간 이벤트/리더보드
- IAP/상점(껍데기만 만들고 비활성 가능)

---

# 1. 화면(Scenes) 목록 + 플로우

## 1.1 씬 구성(권장: 단일 Scene + UI 라우팅)

- `Scene_Main` 하나에서 Canvas 라우팅(권장)
    - 장점: 로딩 단순, 세이브 복귀 용이
- (대안) 멀티 씬: `Boot`, `Home`, `Select`, `Play`, `Result`, `Gallery`

## 1.2 화면 플로우

1. Boot(최초 1회)
2. Home
3. Theme/Image Select
4. Difficulty Select(조각 수)
5. Loading(조각 생성/텍스처 준비)
6. Puzzle Play
7. Result
8. Gallery(완성작) → Home로 복귀

---

# 2. 화면별 UI 구성요소(세부 컴포넌트 단위)

## 2.1 Boot / Splash(옵션)

- 로고/로딩 스피너
- (내부) Addressables 초기화, 저장 데이터 로드, 마지막 세션 존재 여부 체크

## 2.2 Home

**상단 바(TopBar)**

- 좌: 프로필/레벨(옵션, MVP에선 숨김 가능)
- 중앙: 게임 타이틀/현재 테마 요약
- 우: 코인 표시(`CoinCounter`), 설정 버튼

**메인 영역**

- `ContinueCard`(저장된 진행 중 퍼즐 있으면 노출)
    - 썸네일, 진행률(%), “이어하기” 버튼, “포기” 버튼(확인 팝업)
- `PlayButton`(새 퍼즐 시작) 또는 `ThemeSelectEntry`

**하단**

- `DailyRewardWidget`(MVP에서는 “오늘 1회 무료 코인” 수준으로 단순화 가능)

## 2.3 Theme / Image Select

- 상단: 뒤로가기, 타이틀(“테마 선택”), 코인
- 본문: `ImageGrid`
    - 카드 구성: 썸네일, 이름(텍스트 최소화 가능), 잠금 여부(오버레이)
- 하단: 필터(옵션) / 랜덤 선택 버튼(옵션)

## 2.4 Difficulty Select(조각 수 선택)

- 상단: 뒤로가기, 타이틀, 코인
- 본문: `DifficultyCards` 3개
    - Easy(24) / Normal(48) / Hard(96)
    - 각 카드에 예상 시간(정확도 낮아도 됨) + 힌트 보너스(옵션)
- 하단: Start 버튼

## 2.5 Loading(오버레이 가능)

- 진행바, “퍼즐 준비 중…”
- 내부 작업:
    - 이미지 로드/리사이즈(디바이스 해상도 맞춤)
    - 조각 마스크 생성/적용
    - 초기 조각 트레이 배치
    - 세션 데이터 생성 및 초기 저장

## 2.6 Puzzle Play(핵심)

**상단 바**

- 좌: 뒤로(일시정지 팝업), 가운데: 진행률(맞춘 조각/전체), 우: 타이머(옵션), 코인(옵션)

**중앙 플레이 영역**

- `PuzzleBoard`(정답 위치 기준)
    - 보드에는 “고스트 윤곽”은 기본 Off(힌트로만)
- `PieceLayer`(드래그되는 조각)
- `GroupLayer`(맞춘 조각 그룹 이동용, 선택 기능)

**하단 트레이 영역**

- `PieceTray`(가로 스크롤)
- `SortTabs`(옵션): “전체/외곽/색상” 탭(색상은 MVP에서는 비활성 가능)

**하단 액션 바(힌트/기능)**

- 힌트 버튼 3개 + 리워드(광고) 진입
    1. `Hint_EdgeOnly` : 외곽 조각만 하이라이트/필터
    2. `Hint_ShowGhost` : 원본 반투명 오버레이(10초, 쿨다운)
    3. `Hint_PlaceOne` : 특정 조각 1개 정답 위치로 스냅
- `Shuffle`(트레이 섞기), `Zoom`(핀치/버튼) 중 1개는 MVP에서 제공 권장

**일시정지 팝업(PauseModal)**

- 계속하기
- 힌트 받기(리워드 광고)
- 홈으로(진행 저장 안내)
- 퍼즐 포기(확인)

## 2.7 Result

- 완성 연출(파티클/진동 1회)
- 완성 이미지 전체 표시(줌 가능)
- 보상
    - 기본 코인 + (리워드 광고로 2배) 버튼
- 버튼
    - 다음 퍼즐(랜덤/같은 테마)
    - 갤러리 보기
    - 홈

## 2.8 Gallery

- 완료한 이미지 그리드
- 카드: 썸네일, 완료 배지
- 상세 진입: 큰 이미지, 공유(옵션), 다시 플레이

## 2.9 Settings(최소)

- BGM On/Off
- SFX On/Off
- 진동 On/Off
- 개인정보/약관(링크, 옵션)

---

# 3. 시스템 규칙(보상 / 힌트 / 세이브)

## 3.1 재화(코인) 규칙

- 코인 획득
    - 퍼즐 완료 기본 보상: `BaseCoin = 50`(난이도 가중치 적용)
        - 24조각: 50
        - 48조각: 80
        - 96조각: 130
    - 리워드 광고 시 2배(= 추가로 BaseCoin만큼 더 지급)
- 코인 사용
    - 힌트 구매 또는 힌트 부족 시 대체 결제
    - MVP 권장 가격:
        - EdgeOnly: 10
        - ShowGhost(10초): 15
        - PlaceOne: 25

## 3.2 힌트 규칙(무료 + 광고 + 코인)

- 기본 제공(일일 무료)
    - 하루 시작 시: EdgeOnly 3회, ShowGhost 2회, PlaceOne 1회
- 부족할 때:
    - (1순위) 리워드 광고 시 힌트 1회 충전(선택 팝업: 어떤 힌트 충전할지)
    - (2순위) 코인으로 구매
- 힌트 상세 동작
    1. **EdgeOnly**
        - 트레이/보드에서 외곽 조각을 강조(밝기/테두리) 또는 필터 보기 전환
        - 지속: 토글형(해제 가능)
    2. **ShowGhost**
        - 보드 위에 원본 이미지 반투명 오버레이
        - 지속: 10초, 쿨다운 20초(중복 사용 방지)
    3. **PlaceOne**
        - 아직 미완료 조각 1개를 선택(자동 선택 가능) → 정답 위치로 스냅 처리
        - 우선순위: 사용자가 마지막으로 집은 조각 > 외곽 조각 > 랜덤
- 정체 감지(이탈 방지, 옵션)
    - 30초 이상 스냅 성공 없으면 “힌트 사용” 소프트 추천 토스트 1회

## 3.3 광고 규칙(MVP)

- **리워드 광고(필수)**
    - 결과 화면: 코인 2배
    - 플레이 중: 힌트 1회 충전
- **인터스티셜(선택, 매우 보수적)**
    - MVP에서는 Off 권장 또는 “완료 3회당 1회”
    - 사용 시에도: Result→Home 전환 시에만 노출(플레이 흐름 방해 금지)

## 3.4 세이브/로드(가장 중요)

### 저장 시점(자동)

- 퍼즐 시작 직후 1회 저장
- 스냅 성공 시 저장(빈도 제한: 1~2초 디바운스)
- 앱 백그라운드 진입/종료 이벤트 시 저장
- Pause에서 홈으로 나갈 때 저장

### 저장 데이터(권장 스키마)

- `PlayerProfile`
    - coin, settings, dailyHintState(날짜 스탬프 포함)
- `ActivePuzzleSession` (진행 중 1개만)
    - sessionId
    - imageId, difficultyId, seed(조각 생성 재현용)
    - elapsedTime
    - placedPieceIds(또는 각 조각의 상태/좌표)
    - pieceTransforms: `{pieceId, x, y, rot, inBoard(bool), groupId(optional)}`
    - hintUsage: `{edgeUsed, ghostUsed, placeUsed}`
    - lastSaveUtc

### 복귀 규칙

- 앱 실행 시 `ActivePuzzleSession` 존재하면 Home의 ContinueCard 활성
- 이어하기 진입 시:
    - 동일 seed로 조각 재생성 후, 저장된 transforms/state를 적용
- “포기” 선택 시 `ActivePuzzleSession` 삭제(코인 환급 없음)

---

# 4. 퍼즐 플레이 구현 규칙(코어 메카닉)

## 4.1 조각 생성(간단 MVP)

- 입력: 원본 이미지 텍스처(퍼즐 경계 없음)
- 난이도별 그리드: 예) 24=6x4, 48=8x6, 96=12x8 (디바이스 비율에 맞게 조정)
- 각 셀에 지그소 마스크 적용(탭/노치)
- 조각 렌더링:
    - Sprite/Texture2D 생성 또는 RenderTexture 기반(성능 고려)
- 초기 배치:
    - 트레이에 랜덤 섞기
    - 보드에는 배치하지 않음

## 4.2 스냅 판정

- 각 조각의 정답 위치(Anchor)와 현재 위치의 거리 < `SnapThreshold`이면 스냅
- 스냅 시:
    - 조각 위치/회전 정답값으로 고정
    - 드래그 비활성(또는 “그룹”으로만 이동)
    - 성공 사운드/햅틱 1회
- SnapThreshold는 조각 크기 비례(예: 조각 가로의 15~20%)

## 4.3 그룹 이동(선택 구현)

- 스냅된 조각들은 개별 이동 불가로 두고 MVP 단순화 가능
- 확장안: 인접 스냅 조각끼리 그룹으로 묶어 함께 이동(중급 난이도 대응)

## 4.4 카메라/줌

- 기본: 1배 고정 + “보드 위치 이동(패닝)” 정도만 제공해도 MVP 가능
- 권장: 핀치 줌(최소/최대 제한), 더블탭 줌

---

# 5. 개발 체크리스트(엔지니어 실행 항목)

## 5.1 프로젝트/아키텍처

- [ ]  `GameStateMachine` 설계: Boot/Home/Select/Loading/Play/Result/Gallery
- [ ]  UI 라우팅(단일 씬 기준): ScreenStack + ModalManager
- [ ]  ScriptableObject로 정적 데이터 분리
    - [ ]  `ImageCatalogSO` (imageId, 주소, 태그, 난이도 추천)
    - [ ]  `DifficultySO` (grid, rewards, snap threshold)
    - [ ]  `HintConfigSO` (가격, 지속시간, 쿨다운)
- [ ]  Addressables(권장) 또는 Resources(단기 MVP)로 이미지 로드

## 5.2 저장/데이터

- [ ]  로컬 저장: JSON + PlayerPrefs 키(또는 파일 저장)
- [ ]  세션 저장 디바운스(스냅 연속 발생 시 과도 저장 방지)
- [ ]  앱 라이프사이클 훅(OnApplicationPause/Focus/Quit)에서 강제 저장

## 5.3 퍼즐 렌더링/성능

- [ ]  텍스처 리사이즈(모바일 메모리 대응, max 2048/4096 정책)
- [ ]  조각 수 96 기준 60fps 근접 목표(드래그 중 GC 최소화)
- [ ]  드래그 중 Raycast 최소화(선택된 조각만 처리)
- [ ]  오버레이(ShowGhost)는 단일 이미지 레이어로 처리(조각별 처리 금지)

## 5.4 입력/UX

- [ ]  조각 선택 시 항상 최상단으로 올리기(정렬 order)
- [ ]  트레이 스크롤과 조각 드래그 충돌 해결(드래그 우선순위)
- [ ]  햅틱/사운드 토글 준수
- [ ]  접근성: 버튼 최소 터치 영역 44px 이상

## 5.5 광고(선택 포함)

- [ ]  리워드 광고 콜백 안전 처리(중복 지급 방지 플래그)
- [ ]  광고 실패 시 대체 UX(“광고를 불러오지 못했습니다” + 재시도)
- [ ]  인터스티셜은 MVP에서 기본 Off 또는 매우 낮은 빈도

## 5.6 QA 시나리오(필수 테스트)

- [ ]  진행 중 앱 강제 종료 → 재실행 → 이어하기 정상 복구
- [ ]  힌트 사용 중(ShowGhost) 백그라운드 → 복귀 시 타이머/상태 일관성
- [ ]  스냅 임계값/오작동(근접인데 안 붙음, 멀리서 붙음) 튜닝
- [ ]  저사양 기기에서 96조각 드래그 프레임 확인
- [ ]  세로 해상도 다양(16:9, 19.5:9, 20:9) UI 깨짐 방지

---

# 6. 완료 기준(Definition of Done: MVP)

- Home에서 새 퍼즐 시작 및 이어하기가 안정적으로 동작
- 퍼즐 플레이에서 드래그/스냅/힌트 3종이 의도대로 동작
- 완료 시 Result 보상 지급(리워드 2배 포함) 및 Gallery 저장
- 자동 저장/복구가 재현 가능하게 안정적
- 세로 UI 레이아웃이 주요 해상도에서 무너짐 없음